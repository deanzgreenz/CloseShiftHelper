<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Close Shift & Daily Deposit Helper</n  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .tabs { display: flex; margin-bottom: 20px; }
    .tab { padding: 10px 20px; cursor: pointer; border: 1px solid #ccc; border-bottom: none; background: #f9f9f9; }
    .tab.active { background: #fff; font-weight: bold; }
    .panel { border: 1px solid #ccc; padding: 20px; display: none; }
    .panel.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    input[type="number"] { width: 80px; }
    .actions { margin-top: 10px; }
    .actions button { margin-right: 10px; }
  </style>
</head>
<body>
  <h1>Close Shift & Daily Deposit Helper</h1>
  <div class="tabs">
    <div class="tab active" data-target="close-shift">Close Shift</div>
    <div class="tab" data-target="daily-deposit">Complete Daily Deposit</div>
  </div>

  <!-- Close Shift Panel -->
  <div id="close-shift" class="panel active">
    <h2>Close Shift</h2>
    <div>
      <label>Bills (After $480 removed for Reset Till): </label>
      <input id="bills" type="number" step="0.01" value="0"> <span>Total Cash From Cash Counter</span>
    </div>
    <h3>Till Flipper</h3>
    <table>
      <thead><tr><th>Coin</th><th>Par</th><th>Counted</th><th>Action</th></tr></thead>
      <tbody>
        <tr><td>Quarters</td><td>10</td><td><input class="coin" data-par="10" id="quarters" type="number" step="0.01" value="10"></td><td id="act-quarters"></td></tr>
        <tr><td>Dimes</td><td>5</td><td><input class="coin" data-par="5" id="dimes" type="number" step="0.01" value="5"></td><td id="act-dimes"></td></tr>
        <tr><td>Nickels</td><td>4</td><td><input class="coin" data-par="4" id="nickels" type="number" step="0.01" value="4"></td><td id="act-nickels"></td></tr>
        <tr><td>Pennies</td><td>1</td><td><input class="coin" data-par="1" id="pennies" type="number" step="0.01" value="1"></td><td id="act-pennies"></td></tr>
        <tr><td>Dollar Coins</td><td>0</td><td><input class="coin" data-par="0" id="dollarcoins" type="number" step="1" value="0"></td><td id="act-dollarcoins"></td></tr>
      </tbody>
    </table>
    <div>
      <label>Total Coin Adjustment ($): </label>
      <span id="coin-adjustment">0.00</span> <em>: Write this total on the Shift Report Receipt</em>
    </div>
    <div>
      <label>Total Cash Drop ($): </label>
      <span id="cash-drop">0.00</span> <em>: Enter this total into POSaBIT as the Closing Drop field, and $500 in the Left In Drawer field</em>
    </div>
    <div class="actions">
      <button id="calc-close-shift">Calculate Close Shift</button>
    </div>
  </div>

  <!-- Daily Deposit Panel -->
  <div id="daily-deposit" class="panel">
    <h2>Complete Daily Deposit</h2>
    <div>
      <label>Total Closing Cash ($): </label>
      <input id="closing-cash" type="number" step="0.01" value="0"> <em>: Remaining Cash Value after all Taxes and Vendor Payouts / Bills have been set aside with a Petty Cash Slip.</em>
    </div>
    <h3>Coin Adjustments from Shifts</h3>
    <div id="coin-adjust-list">
      <div><label>Shift 1:</label> <input class="shift-coin" type="number" step="0.01" value="0"></div>
      <div><label>Shift 2:</label> <input class="shift-coin" type="number" step="0.01" value="0"></div>
      <div><label>Shift 3:</label> <input class="shift-coin" type="number" step="0.01" value="0"></div>
      <div><label>Shift 4:</label> <input class="shift-coin" type="number" step="0.01" value="0"></div>
      <div><label>Shift 5:</label> <input class="shift-coin" type="number" step="0.01" value="0"></div>
      <div><label>Shift 6:</label> <input class="shift-coin" type="number" step="0.01" value="0"></div>
    </div>
    <div>
      <label>Total Closing Coin Adjustments ($): </label>
      <span id="total-coin-adjust-shifts">0.00</span>
    </div>
    <div>
      <label>Actual Deposit ($): </label>
      <span id="actual-deposit">0.00</span>
    </div>
    <div>
      <label>Net Deposit ($): </label>
      <span id="net-deposit">0.00</span>
    </div>
    <div>
      <label>Difference ($): </label>
      <span id="difference-deposit">0.00</span>
    </div>
    <div class="actions">
      <button id="calc-daily-deposit">Calculate Deposit</button>
      <button id="export-excel">Save Daily Deposit Sheet</button>
    </div>
  </div>

  <script>
    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => tab.onclick = () => {
      document.querySelectorAll('.tab, .panel').forEach(el => el.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.target).classList.add('active');
    });

    // Close Shift calculations
    document.getElementById('calc-close-shift').onclick = () => {
      const billVal = parseFloat(document.getElementById('bills').value) || 0;
      let coinAdj = 0;
      document.querySelectorAll('.coin').forEach(input => {
        const par = parseFloat(input.dataset.par);
        const val = parseFloat(input.value) || 0;
        const diff = val - par;
        coinAdj += diff;
        const actCell = document.getElementById('act-' + input.id);
        actCell.textContent = diff === 0 ? 'OK' : diff > 0 ? 'Remove ' + diff.toFixed(2) : 'Add ' + (-diff).toFixed(2);
      });
      document.getElementById('coin-adjustment').textContent = coinAdj.toFixed(2);
      const drop = billVal + coinAdj;
      document.getElementById('cash-drop').textContent = drop.toFixed(2);
    };

    // Daily Deposit calculations
    document.getElementById('calc-daily-deposit').onclick = () => {
      const closingCash = parseFloat(document.getElementById('closing-cash').value) || 0;
      let totalShiftCoins = 0;
      document.querySelectorAll('.shift-coin').forEach(input => totalShiftCoins += parseFloat(input.value) || 0);
      document.getElementById('total-coin-adjust-shifts').textContent = totalShiftCoins.toFixed(2);

      const actual = closingCash + totalShiftCoins;
      document.getElementById('actual-deposit').textContent = actual.toFixed(2);

      // Net Deposit = TotalTendered - TaxCollected
      const params = new URLSearchParams(window.location.search);
      const tendered = parseFloat(params.get('tendered')) || 0;
      const tax = parseFloat(params.get('tax')) || 0;
      const net = tendered - tax;
      document.getElementById('net-deposit').textContent = net.toFixed(2);

      document.getElementById('difference-deposit').textContent = (actual - net).toFixed(2);
    };

    // Excel export stub
    document.getElementById('export-excel').onclick = () => {
      alert('Excel export will download a file matching the Daily Deposit Template.');
      // implement XLSX generation & download here
    };
  </script>
</body>
</html>
