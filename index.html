<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Close Shift & Daily Deposit Helper</n  
  <!-- Simple styling -->
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .tabs { margin-bottom: 20px; }
    .tab-button { padding: 10px 20px; margin-right: 5px; cursor: pointer; }
    .active { background: #007bff; color: white; }
    .section { display: none; }
    .section.active { display: block; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #f2f2f2; }
    input, textarea { width: 100%; box-sizing: border-box; padding: 5px; margin-bottom: 10px; }
    button { padding: 10px 20px; font-size: 16px; }
  </style>
  <!-- SheetJS for Excel export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <h1>Close Shift & Daily Deposit</h1>

  <div class="tabs">
    <button id="tab-close" class="tab-button active">Close Shift</button>
    <button id="tab-deposit" class="tab-button">Complete Daily Deposit</button>
  </div>

  <!-- Close Shift Section -->
  <div id="section-close" class="section active">
    <h2>Close Shift</h2>
    <p>Total Tendered: <span id="posa-total-tendered">0</span></p>
    <p>Total Taxes (rounded): <span id="posa-total-taxes">0</span></p>

    <h3>Reset Till to $500</h3>
    <p>Enter coin counts and see adjustments:</p>
    <table>
      <tr><th>Denomination</th><th>Par</th><th>Counted</th><th>Action</th></tr>
      <tr><td>Quarters</td><td>$10</td><td><input id="coin-quarters" type="number" step="0.01" value="10.00"></td><td id="act-quarters"></td></tr>
      <tr><td>Dimes</td><td>$5</td><td><input id="coin-dimes" type="number" step="0.01" value="5.00"></td><td id="act-dimes"></td></tr>
      <tr><td>Nickels</td><td>$4</td><td><input id="coin-nickels" type="number" step="0.01" value="4.00"></td><td id="act-nickels"></td></tr>
      <tr><td>Pennies</td><td>$1</td><td><input id="coin-pennies" type="number" step="0.01" value="1.00"></td><td id="act-pennies"></td></tr>
      <tr><td>Dollar Coins</td><td>$0</td><td><input id="coin-dollars" type="number" step="1" value="0"></td><td id="act-dollars"></td></tr>
    </table>

    <p>Bills (After $480 removed for Reset Till):</p>
    <p>Total Cash From Cash Counter: <input id="bills-total" type="number" step="0.01"></p>
    <p>Total Coin Adjustment ($) : Write this total on the Shift Report Receipt: <span id="total-coin-adjust">0</span></p>
    <p>Total Cash Drop ($) : Enter this total into POSaBIT as the Closing Drop field, and $500 in the Left In Drawer field: <span id="total-cash-drop">0</span></p>
  </div>

  <!-- Complete Daily Deposit Section -->
  <div id="section-deposit" class="section">
    <h2>Complete Daily Deposit</h2>

    <label>Employee Name:<br><input id="employee-name" type="text"></label>
    <label>Date:<br><input id="deposit-date" type="date"></label>
    <label>Venue:<br><input id="deposit-venue" type="text"></label>

    <h3>Vendor Payouts / Bills</h3>
    <table>
      <tr><th>Description</th><th>Amount</th></tr>
      <!-- 5 vendor rows -->
      <tr><td><input id="vendor-desc-1" type="text"></td><td><input id="vendor-amt-1" type="number" step="0.01"></td></tr>
      <tr><td><input id="vendor-desc-2" type="text"></td><td><input id="vendor-amt-2" type="number" step="0.01"></td></tr>
      <tr><td><input id="vendor-desc-3" type="text"></td><td><input id="vendor-amt-3" type="number" step="0.01"></td></tr>
      <tr><td><input id="vendor-desc-4" type="text"></td><td><input id="vendor-amt-4" type="number" step="0.01"></td></tr>
      <tr><td><input id="vendor-desc-5" type="text"></td><td><input id="vendor-amt-5" type="number" step="0.01"></td></tr>
    </table>
    <p>Total Vendor Payouts: <span id="total-vendor-payouts">0</span></p>

    <h3>Totals</h3>
    <p>Total Tendered: <span id="posa-total-tendered2">0</span></p>
    <p>Total Taxes:    <span id="posa-total-taxes2">0</span></p>
    <p>Net from POSaBIT Sales: <span id="net-sales">0</span></p>
    <p>Net Deposit (minus Vendors): <span id="net-after-vendors">0</span></p>

    <h3>Cash & Coins</h3>
    <p>Total Closing Cash: <input id="closing-cash" type="number" step="0.01"></p>
    <p>Shift Coin Adjustments (6 shifts):</p>
    <div>
      <input id="shift-coin-1" type="number" step="0.01" placeholder="Shift 1"><br>
      <input id="shift-coin-2" type="number" step="0.01" placeholder="Shift 2"><br>
      <input id="shift-coin-3" type="number" step="0.01" placeholder="Shift 3"><br>
      <input id="shift-coin-4" type="number" step="0.01" placeholder="Shift 4"><br>
      <input id="shift-coin-5" type="number" step="0.01" placeholder="Shift 5"><br>
      <input id="shift-coin-6" type="number" step="0.01" placeholder="Shift 6"><br>
    </div>
    <p>Total Closing Coin Adjustment: <span id="total-coin-adjust2">0</span></p>
    <p>Total Cash & Coins: <span id="total-cash-coins">0</span></p>

    <h3>Results</h3>
    <p>Actual Deposit: <span id="actual-deposit">0</span></p>
    <p>Net Deposit:    <span id="net-deposit2">0</span></p>
    <p>Difference:     <span id="difference">0</span></p>

    <p>Money from Change Bag: <input id="change-bag" type="number" step="0.01"></p>
    <p>Notes:<br><textarea id="deposit-notes"></textarea></p>

    <button id="save-deposit-btn">Save Daily Deposit</button>
  </div>

  <!-- Core JS to switch tabs and calculations -->
  <script>
    // Tab functionality
    document.getElementById('tab-close').addEventListener('click',()=>{
      document.getElementById('section-close').classList.add('active');
      document.getElementById('section-deposit').classList.remove('active');
      document.getElementById('tab-close').classList.add('active');
      document.getElementById('tab-deposit').classList.remove('active');
    });
    document.getElementById('tab-deposit').addEventListener('click',()=>{
      document.getElementById('section-deposit').classList.add('active');
      document.getElementById('section-close').classList.remove('active');
      document.getElementById('tab-deposit').classList.add('active');
      document.getElementById('tab-close').classList.remove('active');
    });

    // helpers
    const toNum = s=>parseFloat((s||'').replace(/[^0-9.]/g,''))||0;
    const updateClose = ()=>{
      const par={quarters:10,dimes:5,nickels:4,pennies:1,dollars:0};
      let totalAdj=0;
      for(const coin of ['quarters','dimes','nickels','pennies','dollars']){
        const inp=document.getElementById(`coin-${coin}`);
        const got=toNum(inp.value);
        const diff=got-par[coin];
        totalAdj+=diff;
        document.getElementById(`act-${coin}`).textContent = diff>0 ? `Remove ${diff}`: diff<0?`Add ${-diff}`:'OK';
      }
      document.getElementById('total-coin-adjust').textContent=totalAdj.toFixed(2);
      const bills=toNum(document.getElementById('bills-total').value);
      const drop=(bills + totalAdj).toFixed(2);
      document.getElementById('total-cash-drop').textContent=drop;
    };
    ['quarters','dimes','nickels','pennies','dollars','bills-total'].forEach(id=>{
      document.getElementById(`coin-${id}`)?
        document.getElementById(`coin-${id}`).addEventListener('input',updateClose)
        : document.getElementById(id).addEventListener('input',updateClose);
    });
    updateClose();
    
    // populate POSaBIT values and deposit-date/venue
    const url = new URL(window.location.href);
    document.getElementById('deposit-venue').value = url.searchParams.get('store')||'';
    document.getElementById('posa-total-tendered').textContent = url.searchParams.get('tendered')||0;
    document.getElementById('posa-total-taxes').textContent   = url.searchParams.get('tax')||0;
    document.getElementById('posa-total-tendered2').textContent = url.searchParams.get('tendered')||0;
    document.getElementById('posa-total-taxes2').textContent   = url.searchParams.get('tax')||0;
    document.getElementById('deposit-date').value = new Date().toISOString().slice(0,10);

    // update deposit calcs live
    const updateDeposit = ()=>{
      const t = toNum(document.getElementById('posa-total-tendered2').textContent);
      const x = toNum(document.getElementById('posa-total-taxes2').textContent);
      const net = t - x;
      document.getElementById('net-sales').textContent = net.toFixed(2);

      let vendors=0;
      for(let i=1;i<=5;i++) vendors += toNum(document.getElementById(`vendor-amt-${i}`).value);
      document.getElementById('total-vendor-payouts').textContent = vendors.toFixed(2);
      document.getElementById('net-after-vendors').textContent = (net - vendors).toFixed(2);

      const cash = toNum(document.getElementById('closing-cash').value);
      let coins=0;
      for(let i=1;i<=6;i++) coins+=toNum(document.getElementById(`shift-coin-${i}`).value);
      document.getElementById('total-coin-adjust2').textContent = coins.toFixed(2);

      const totalCC = cash + coins;
      document.getElementById('total-cash-coins').textContent = totalCC.toFixed(2);

      document.getElementById('actual-deposit').textContent = totalCC.toFixed(2);
      document.getElementById('net-deposit2').textContent    = (net - vendors).toFixed(2);
      document.getElementById('difference').textContent       = (totalCC - (net - vendors)).toFixed(2);
    };
    ['vendor-amt-1','vendor-amt-2','vendor-amt-3','vendor-amt-4','vendor-amt-5',
     'closing-cash', 'shift-coin-1','shift-coin-2','shift-coin-3','shift-coin-4','shift-coin-5','shift-coin-6']
      .forEach(id=> document.getElementById(id).addEventListener('input', updateDeposit));
    updateDeposit();

    // Save button handler in separate script (already included above)
  </script>
</body>
</html>
