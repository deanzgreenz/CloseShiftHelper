<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Close Shift & Daily Deposit Helper</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    .tabs { list-style: none; padding: 0; display: flex; border-bottom: 2px solid #ccc; }
    .tabs li { margin-right: 1rem; padding: 0.5rem; cursor: pointer; }
    .tabs .active { border-bottom: 2px solid #007bff; font-weight: bold; }
    .panel { display: none; padding-top: 1rem; }
    .panel.active { display: block; }
    .row { display: flex; margin-bottom: 0.5rem; }
    .row label { flex: 0 0 200px; }
    .row input { flex: 1; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 0.5rem; text-align: left; }
    .small { width: 5rem; }
    .btn { padding: 0.5rem 1rem; margin-top: 1rem; cursor: pointer; }
  </style>
</head>
<body>
  <ul class="tabs">
    <li id="tab-close" class="active">Close Shift</li>
    <li id="tab-deposit">Complete Daily Deposit</li>
  </ul>

  <div id="panel-close" class="panel active">
    <h2>Close Shift</h2>
    <div class="row"><label>Bills (After $480 removed for Reset Till):</label><input id="bills" type="number" step="0.01"></div>
    <div id="coin-table"></div>
    <div class="row"><label>Total Coin Adjustment ($):</label><span id="coin-adjustment">0.00</span></div>
    <div class="row"><label>Total Cash From Cash Counter ($):</label><span id="bills-total">0.00</span></div>
    <div class="row"><label>Total Cash Drop ($):</label><span id="cash-drop">0.00</span></div>
  </div>

  <div id="panel-deposit" class="panel">
    <h2>Complete Daily Deposit</h2>
    <div class="row"><label>Name:</label><input id="emp-name" type="text"></div>
    <div class="row"><label>Date:</label><input id="dep-date" type="date"></div>
    <div class="row"><label>Venue:</label><input id="dep-venue" type="text" readonly></div>
    <h3>Vendor Payouts / Bills</h3>
    <div id="vendors"></div>
    <button id="add-vendor" class="btn">Add Vendor/Bill Row</button>
    <div class="row"><label>Total Vendor Payouts:</label><span id="total-vendors">0.00</span></div>
    <h3>Totals</h3>
    <div class="row"><label>Total Tendered ($):</label><span id="pos-tendered">0.00</span></div>
    <div class="row"><label>Total Taxes ($):</label><span id="pos-taxes">0.00</span></div>
    <div class="row"><label>Net from POSaBIT Sales ($):</label><span id="net-pos">0.00</span></div>
    <div class="row"><label>Net after Payouts ($):</label><span id="net-after">0.00</span></div>
    <h3>Cash & Coins</h3>
    <div class="row"><label>Total Closing Cash ($):</label><input id="closing-cash" type="number" step="0.01"></div>
    <h4>Shift Coin Adjustments</h4>
    <div id="shift-coins"></div>
    <button id="add-shift" class="btn">Add Shift Adjustment</button>
    <div class="row"><label>Total Closing Coin Adjustments ($):</label><span id="total-coin-adj">0.00</span></div>
    <div class="row"><label>Total Cash & Coins ($):</label><span id="total-cash-coins">0.00</span></div>
    <h3>Results</h3>
    <div class="row"><label>Actual Deposit ($):</label><span id="actual-deposit">0.00</span></div>
    <div class="row"><label>Net Deposit ($):</label><span id="net-deposit">0.00</span></div>
    <div class="row"><label>Difference ($):</label><span id="difference">0.00</span></div>
    <div class="row"><label>Money from Change Bag ($):</label><input id="change-bag" type="number" step="0.01"></div>
    <div class="row"><label>Notes:</label><input id="notes" type="text"></div>
    <button id="save-deposit" class="btn">Save Daily Deposit</button>
  </div>

  <script>
    // Tab switching
    document.getElementById('tab-close').onclick = () => { show('close'); };
    document.getElementById('tab-deposit').onclick = () => { show('deposit'); };
    function show(tab) {
      document.querySelectorAll('.tabs li').forEach(li=>li.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
      document.getElementById('tab-'+tab).classList.add('active');
      document.getElementById('panel-'+tab).classList.add('active');
    }

    // Initialize date
    document.getElementById('dep-date').valueAsDate = new Date();
    // Parse URL params
    const params = new URLSearchParams(location.search);
    ['tendered','tax','store'].forEach(k => { if(params.has(k)) document.getElementById(k==='store'?'dep-venue':(k==='tendered'?'pos-tendered':'pos-taxes')).textContent = parseFloat(params.get(k)).toFixed(2); });

    // Vendors
    const vendorsDiv = document.getElementById('vendors');
    document.getElementById('add-vendor').onclick = ()=>{
      const idx = vendorsDiv.children.length;
      const row = document.createElement('div'); row.className='row';
      row.innerHTML = `<input placeholder="Desc" id="vend-desc-${idx}" /><input placeholder="Amount" id="vend-amt-${idx}" type=number step=0.01 class="small" />`;
      vendorsDiv.append(row);
      row.querySelector('input[type]').oninput = updateVendors;
    };
    function updateVendors() {
      let sum=0;
      vendorsDiv.querySelectorAll('.row').forEach(r=>{
        const val=parseFloat(r.querySelector('input[type]').value)||0; sum+=val;
      });
      document.getElementById('total-vendors').textContent = sum.toFixed(2);
      updateNetAfter(); updateResults();
    }

    // Close Shift: coin flipper
    const coinPar = { quarters:10, dimes:5, nickels:4, pennies:1, dollar:0 };
    const coinNames = ['quarters','dimes','nickels','pennies','dollar'];
    const coinTable = document.getElementById('coin-table');
    function initCoinTable() {
      let html = '<table><tr><th>Coin</th><th>Par</th><th>Counted</th><th>Action</th></tr>';
      coinNames.forEach(c=>{
        html+=`<tr><td>${c.charAt(0).toUpperCase()+c.slice(1)}</td><td>${coinPar[c]}</td><td><input type=number step=1 min=0 id="coin-${c}" class="small"></td><td id="act-${c}"></td></tr>`;
      }); html+='</table>';
      coinTable.innerHTML = html;
      coinNames.forEach(c=> document.getElementById('coin-'+c).oninput = updateCoins);
      document.getElementById('bills').oninput = ()=>{
        document.getElementById('bills-total').textContent = parseFloat(document.getElementById('bills').value||0).toFixed(2);
        updateCashDrop();
      };
    }
    function updateCoins(){
      let diffSum=0;
      coinNames.forEach(c=>{
        const val = parseInt(document.getElementById('coin-'+c).value)||0;
        const diff = val - coinPar[c];
        document.getElementById('act-'+c).textContent = diff>0?`Remove ${diff}`:(diff<0?`Add ${-diff}`:'OK');
        diffSum += diff * (c==='quarters'?0.25:c==='dimes'?0.10:c==='nickels'?0.05:c==='pennies'?0.01:c==='dollar'?1:0);
      });
      document.getElementById('coin-adjustment').textContent = diffSum.toFixed(2);
      updateCashDrop(); updateShiftDeposit();
    }
    function updateCashDrop(){
      const bills = parseFloat(document.getElementById('bills').value)||0;
      const coinAdj = parseFloat(document.getElementById('coin-adjustment').textContent)||0;
      document.getElementById('cash-drop').textContent = (bills + coinAdj).toFixed(2);
    }

    // Daily Deposit Helpers
    function updateNetAfter(){ updateShiftDeposit(); }
    function updateShiftDeposit(){
      const tendered = parseFloat(document.getElementById('pos-tendered').textContent)||0;
      const taxes = parseFloat(document.getElementById('pos-taxes').textContent)||0;
      const netPos = tendered - taxes;
      document.getElementById('net-pos').textContent = netPos.toFixed(2);
      const vendors = parseFloat(document.getElementById('total-vendors').textContent)||0;
      document.getElementById('net-after').textContent = (netPos - vendors).toFixed(2);
    }
    // Shift coin adjustments on deposit side
    const shiftDiv = document.getElementById('shift-coins');
    document.getElementById('add-shift').onclick = ()=>{
      const idx = shiftDiv.children.length;
      const row = document.createElement('div'); row.className='row';
      row.innerHTML = `<label>Shift ${idx+1} Adj ($):</label><input id="shift-${idx}" type=number step=0.01 class="small">`;
      shiftDiv.append(row);
      row.querySelector('input').oninput = updateShiftCoins;
    };
    function updateShiftCoins(){
      let sum=0;
      shiftDiv.querySelectorAll('input').forEach(i=> sum += parseFloat(i.value)||0);
      document.getElementById('total-coin-adj').textContent = sum.toFixed(2);
      const closingCash = parseFloat(document.getElementById('closing-cash').value)||0;
      document.getElementById('total-cash-coins').textContent = (closingCash + sum).toFixed(2);
      updateResults();
    }
    document.getElementById('closing-cash').oninput = updateShiftCoins;

    function updateResults(){
      const actual = parseFloat(document.getElementById('total-cash-coins').textContent)||0;
      document.getElementById('actual-deposit').textContent = actual.toFixed(2);
      const netAfter = parseFloat(document.getElementById('net-after').textContent)||0;
      document.getElementById('net-deposit').textContent = netAfter.toFixed(2);
      document.getElementById('difference').textContent = (actual - netAfter).toFixed(2);
    }

    // Save to Excel (simple CSV->xls)
    document.getElementById('save-deposit').onclick = ()=>{
      const wbRows = [];
      wbRows.push(["Name", document.getElementById('emp-name').value]);
      wbRows.push(["Date", document.getElementById('dep-date').value]);
      wbRows.push(["Venue", document.getElementById('dep-venue').value]);
      wbRows.push([]);
      wbRows.push(["Vendor", "Amount"]);
      vendorsDiv.querySelectorAll('.row').forEach(r=>{
        wbRows.push([ r.querySelector('input').value, parseFloat(r.querySelectorAll('input')[1].value)||0 ]);
      });
      wbRows.push(["Total Vendor Payouts", parseFloat(document.getElementById('total-vendors').textContent)]);
      wbRows.push([]);
      wbRows.push(["Total Tendered", document.getElementById('pos-tendered').textContent]);
      wbRows.push(["Total Taxes", document.getElementById('pos-taxes').textContent]);
      wbRows.push(["Net from POSaBIT Sales", document.getElementById('net-pos').textContent]);
      wbRows.push(["Net after Payouts", document.getElementById('net-after').textContent]);
      wbRows.push([]);
      wbRows.push(["Total Closing Cash", document.getElementById('closing-cash').value]);
      shiftDiv.querySelectorAll('input').forEach((i,ix)=> wbRows.push([`Shift ${ix+1} Adj`, i.value]));
      wbRows.push(["Total Closing Coin Adjustments", document.getElementById('total-coin-adj').textContent]);
      wbRows.push(["Total Cash & Coins", document.getElementById('total-cash-coins').textContent]);
      wbRows.push([]);
      wbRows.push(["Actual Deposit", document.getElementById('actual-deposit').textContent]);
      wbRows.push(["Net Deposit", document.getElementById('net-deposit').textContent]);
      wbRows.push(["Difference", document.getElementById('difference').textContent]);
      wbRows.push([]);
      wbRows.push(["Money from Change Bag", document.getElementById('change-bag').value]);
      wbRows.push(["Notes", document.getElementById('notes').value]);

      let csv = wbRows.map(r=> r.map(c=>`"${c}"`).join(',')).join('\n');
      const blob = new Blob([csv],{ type:'application/vnd.ms-excel' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `DailyDeposit_${document.getElementById('dep-venue').value}_${document.getElementById('dep-date').value}.xls`;
      a.click();
      URL.revokeObjectURL(url);
    };

    // Boot
    initCoinTable();
  </script>
</body>
</html>
