<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Close Shift & Daily Deposit</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .tabs { display: flex; background:#333; }
    .tab { padding: 1rem; color:#fff; cursor:pointer; flex:1; text-align:center; }
    .tab.active { background:#555; }
    .panel { padding:1rem; display:none; }
    .panel.active { display:block; }
    .section { margin-bottom:1.5rem; }
    .section h2 { margin-bottom:.5rem; }
    label { display:block; margin:.25rem 0; }
    input[type=number], input[type=text], input[type=date] { width:100%; padding:.5rem; }
    table { width:100%; border-collapse:collapse; margin-top:.5rem; }
    th, td { border:1px solid #ccc; padding:.5rem; text-align:right; }
    th { background:#eee; }
    .flex { display:flex; gap:1rem; }
    .flex > div { flex:1; }
    button { padding:.75rem 1.5rem; background:#28a745; color:#fff; border:none; cursor:pointer; }
  </style>
</head>
<body>
  <div class="tabs">
    <div class="tab active" data-target="close">Close Shift</div>
    <div class="tab" data-target="deposit">Complete Daily Deposit</div>
  </div>
  <div id="close" class="panel active">
    <div class="section">
      <h2>Close Shift</h2>
      <div><strong>Store:</strong> <span id="cs-store"></span></div>
      <div><strong>Tendered:</strong> $<span id="cs-tendered">0.00</span></div>
      <div><strong>Taxes:</strong> $<span id="cs-tax">0.00</span></div>
    </div>
    <div class="section">
      <h2>Till Flipper</h2>
      <table id="coin-table">
        <thead><tr><th>Denomination</th><th>Par</th><th>Counted</th><th>Action</th></tr></thead>
        <tbody>
          <!-- rows inserted by JS -->
        </tbody>
      </table>
    </div>
    <div class="section">
      <h2>Bills (After $480 removed for Reset Till)</h2>
      <label>Total Cash From Cash Counter ($): <input type="number" id="cs-bills" value="0"></label>
      <label>Total Coin Adjustment ($): <input type="number" id="cs-coin-adj" readonly> <small>Write this total on the Shift Report Receipt</small></label>
      <label>Total Cash Drop ($): <input type="number" id="cs-cash-drop" readonly> <small>Enter this total into POSaBIT as the Closing Drop field, and $500 in the Left In Drawer field</small></label>
    </div>
  </div>
  <div id="deposit" class="panel">
    <div class="section">
      <h2>Complete Daily Deposit</h2>
      <label>Name: <input type="text" id="dd-name"></label>
      <label>Date: <input type="date" id="dd-date"></label>
      <label>Venue: <input type="text" id="dd-store" readonly></label>
    </div>
    <div class="section">
      <h2>Vendor Payouts / Bills</h2>
      <div id="vp-list">
        <!-- 5 rows -->
      </div>
      <label>Total Vendor Payouts ($): <input type="number" id="dd-vp-total" readonly></label>
    </div>
    <div class="section">
      <h2>Totals</h2>
      <div>Tendered: $<span id="dd-tendered">0.00</span></div>
      <div>Taxes: $<span id="dd-tax">0.00</span></div>
      <div>Net from POSaBIT Sales: $<span id="dd-net-pos">0.00</span></div>
      <div>Total Vendor Payouts: $<span id="dd-vp-total2">0.00</span></div>
      <div>Net Deposit: $<span id="dd-net-dep">0.00</span></div>
    </div>
    <div class="section">
      <h2>Cash & Coins</h2>
      <label>Total Closing Cash ($): <input type="number" id="dd-closing-cash"></label>
      <h3>Shift Coin Adjustments</h3>
      <div id="cc-list">
        <!-- 6 fields -->
      </div>
      <label>Total Closing Coin Adjustment ($): <input type="number" id="dd-coin-adj" readonly></label>
      <label>Total Cash & Coins ($): <input type="number" id="dd-cash-coins" readonly></label>
    </div>
    <div class="section">
      <h2>Results</h2>
      <div>Actual Deposit: $<span id="dd-actual">0.00</span></div>
      <div>Net Deposit: $<span id="dd-net-dep2">0.00</span></div>
      <div>Difference: $<span id="dd-diff">0.00</span></div>
      <label>Money from Change Bag: <input type="number" id="dd-change"></label>
      <label>Notes:<textarea id="dd-notes" style="width:100%;height:4rem;"></textarea></label>
    </div>
    <div class="section">
      <button id="save-btn">Save Daily Deposit</button>
    </div>
  </div>

  <script>
    // Tab logic
    document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>{
      document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      document.getElementById(t.dataset.target).classList.add('active');
    }));

    // Read URL params
    const params = new URLSearchParams(location.search);
    const store = params.get('store')||'';
    const tendered = parseFloat(params.get('tendered')||0);
    const tax = parseFloat(params.get('tax')||0);

    // Close Shift populate
    document.getElementById('cs-store').textContent = store;
    document.getElementById('cs-tendered').textContent = tendered.toFixed(2);
    document.getElementById('cs-tax').textContent = tax.toFixed(2);

    // Coin flipper data
    const coins = [
      {name:'Quarters', par:10, value:0.25},
      {name:'Dimes', par:5, value:0.10},
      {name:'Nickels', par:4, value:0.05},
      {name:'Pennies', par:1, value:0.01},
      {name:'Dollar Coins', par:0, value:1.00},
    ];
    const tbody = document.querySelector('#coin-table tbody');
    coins.forEach(c=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td style="text-align:left">${c.name}</td><td>${c.par}</td><td><input type=number step=1 min=0 data-name="${c.name}" data-par="${c.par}" data-val="${c.value}" value="${c.par}"></td><td class="act-${c.name}">OK</td>`;
      tbody.appendChild(tr);
    });

    function updateCoins(){
      let coinAdj=0;
      document.querySelectorAll('#coin-table tbody tr').forEach(row=>{
        const inp = row.querySelector('input');
        const par=+inp.dataset.par;
        const cnt=+inp.value;
        const name=inp.dataset.name;
        const diff=cnt-par;
        coinAdj += diff*inp.dataset.val;
        const cell = row.querySelector('td:last-child');
        if(diff>0) cell.textContent = `Remove ${diff}`;
        else if(diff<0) cell.textContent = `Add ${-diff}`;
        else cell.textContent = 'OK';
      });
      document.getElementById('cs-coin-adj').value = coinAdj.toFixed(2);
      const bills = parseFloat(document.getElementById('cs-bills').value)||0;
      const drop = bills + coinAdj;
      document.getElementById('cs-cash-drop').value = drop.toFixed(2);
    }
    document.querySelectorAll('#coin-table input, #cs-bills').forEach(el=>el.addEventListener('input', updateCoins));
    updateCoins();

    // Daily Deposit init
    document.getElementById('dd-date').value = new Date().toISOString().slice(0,10);
    document.getElementById('dd-store').value = store;
    document.getElementById('dd-tendered').textContent = tendered.toFixed(2);
    document.getElementById('dd-tax').textContent = tax.toFixed(2);
    function updDeposit(){
      const t= tendered;
      const x= tax;
      const netPos = t - x;
      document.getElementById('dd-net-pos').textContent = netPos.toFixed(2);
      // vendors
      let vpSum=0;
      document.querySelectorAll('.vp-amt').forEach(i=> vpSum += parseFloat(i.value)||0);
      document.getElementById('dd-vp-total').value = vpSum.toFixed(2);
      document.getElementById('dd-vp-total2').textContent = vpSum.toFixed(2);
      document.getElementById('dd-net-dep').textContent = (netPos - vpSum).toFixed(2);
      // coin adjustments
      let ccSum=0;
      document.querySelectorAll('.cc-amt').forEach(i=> ccSum += parseFloat(i.value)||0);
      document.getElementById('dd-coin-adj').value = ccSum.toFixed(2);
      const closeCash = parseFloat(document.getElementById('dd-closing-cash').value)||0;
      document.getElementById('dd-cash-coins').value = (closeCash+ccSum).toFixed(2);
      const act = closeCash+ccSum;
      document.getElementById('dd-actual').textContent = act.toFixed(2);
      const netDep = netPos - vpSum;
      document.getElementById('dd-net-dep2').textContent = netDep.toFixed(2);
      document.getElementById('dd-diff').textContent = (act-netDep).toFixed(2);
    }
    // vendor rows
    const vpList = document.getElementById('vp-list');
    for(let i=0;i<5;i++){
      const div = document.createElement('div');
      div.innerHTML = `
        <input type=text placeholder="Desc" class="vp-desc">
        <input type=number placeholder="Amount" class="vp-amt" style="width:30%;">
      `;
      vpList.appendChild(div);
    }
    // coin adjust fields
    const ccList = document.getElementById('cc-list');
    for(let i=0;i<6;i++){
      const div = document.createElement('div');
      div.innerHTML = `<input type=number class="cc-amt" placeholder="Coin Adj #${i+1}">`;
      ccList.appendChild(div);
    }
    document.querySelectorAll('.vp-amt, .cc-amt, #dd-closing-cash').forEach(el=>el.addEventListener('input', updDeposit));
    updDeposit();

    // Save stub
    document.getElementById('save-btn').addEventListener('click',()=>{
      alert('Saving Excel not implemented yet');
    });
  </script>
</body>
</html>