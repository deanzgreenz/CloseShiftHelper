<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Close Shift & Daily Deposit Helper</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .tabs { margin-bottom: 20px; }
    .tabs button { padding: 10px 20px; margin-right: 5px; }
    section { display: none; }
    section.active { display: block; }
    label { display: block; margin-top: 10px; }
    input[type=number] { width: 150px; padding: 5px; }
    .readonly { background-color: #eee; }
    .export { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Close Shift & Daily Deposit Helper</h1>
  <div class="tabs">
    <button id="tab-close">Close Shift</button>
    <button id="tab-deposit">Complete Daily Deposit</button>
  </div>

  <!-- Close Shift Section -->
  <section id="close-shift" class="active">
    <h2>Close Shift</h2>
    <!-- existing close-shift fields and script should remain here -->
    <!-- ... (omitted for brevity) ... -->
  </section>

  <!-- Daily Deposit Section -->
  <section id="daily-deposit">
    <h2>Complete Daily Deposit</h2>

    <label>Total Tendered ($):</label>
    <input id="tendered" type="number" class="readonly" readonly>

    <label>Tax Collected (Rounded) ($):</label>
    <input id="taxCollected" type="number" class="readonly" readonly>

    <label>Total Cash From Cash Counter ($):</label>
    <input id="closingCash" type="number" step="0.01">
    <small>Remaining Cash Value after all Taxes and Vendor Payouts / Bills have been set aside with a Petty Cash Slip.</small>

    <div id="coin-adjustments">
      <h3>Coin Adjustments ($):</h3>
      <small>Enter each shift's coin adjustment (positive or negative)</small>
      <div>
        <label>Shift 1:</label><input class="coin-input" id="coin1" type="number" step="0.01" value="0">
        <label>Shift 2:</label><input class="coin-input" id="coin2" type="number" step="0.01" value="0">
        <label>Shift 3:</label><input class="coin-input" id="coin3" type="number" step="0.01" value="0">
        <label>Shift 4:</label><input class="coin-input" id="coin4" type="number" step="0.01" value="0">
        <label>Shift 5:</label><input class="coin-input" id="coin5" type="number" step="0.01" value="0">
        <label>Shift 6:</label><input class="coin-input" id="coin6" type="number" step="0.01" value="0">
      </div>
      <label>Total Closing Coin Adjustments ($):</label>
      <input id="totalCoinAdjust" type="number" class="readonly" readonly>
    </div>

    <label>Actual Deposit ($):</label>
    <input id="actualDeposit" type="number" class="readonly" readonly>

    <label>Net Deposit ($):</label>
    <input id="netDeposit" type="number" class="readonly" readonly>

    <label>Difference ($):</label>
    <input id="difference" type="number" class="readonly" readonly>

    <div class="export">
      <button id="export-deposit">Save Daily Deposit Sheet</button>
    </div>
  </section>

  <script>
    // Tab switching
    document.getElementById('tab-close').onclick = () => {
      document.getElementById('close-shift').classList.add('active');
      document.getElementById('daily-deposit').classList.remove('active');
    };
    document.getElementById('tab-deposit').onclick = () => {
      document.getElementById('close-shift').classList.remove('active');
      document.getElementById('daily-deposit').classList.add('active');
      initDeposit();
    };

    // Utility to clean numbers
    const clean = s => parseFloat((s||'').replace(/[^0-9.-]/g,''))||0;

    // Initialize deposit fields from query params
    function initDeposit() {
      const params = new URLSearchParams(location.search);
      document.getElementById('tendered').value = clean(params.get('tendered'));
      document.getElementById('taxCollected').value = clean(params.get('tax'));
      updateDeposit();
    }

    // Update calculations in deposit
    function updateDeposit() {
      const closingCash = clean(document.getElementById('closingCash').value);
      const coins = Array.from(document.querySelectorAll('.coin-input')).map(el=>clean(el.value));
      const totalCoin = coins.reduce((a,b)=>a+b,0);
      document.getElementById('totalCoinAdjust').value = totalCoin.toFixed(2);

      const actual = closingCash + totalCoin;
      document.getElementById('actualDeposit').value = actual.toFixed(2);

      const tendered = clean(document.getElementById('tendered').value);
      const tax = clean(document.getElementById('taxCollected').value);
      const net = tendered - tax;
      document.getElementById('netDeposit').value = net.toFixed(2);

      const diff = actual - net;
      document.getElementById('difference').value = diff.toFixed(2);
    }

    // Attach listeners
    document.getElementById('closingCash').addEventListener('input', updateDeposit);
    document.querySelectorAll('.coin-input').forEach(el=>el.addEventListener('input', updateDeposit));

    // Export deposit to Excel
    document.getElementById('export-deposit').addEventListener('click', ()=>{
      const wb = XLSX.utils.book_new();
      const data = [{
        'Total Tendered ($)': document.getElementById('tendered').value,
        'Tax Collected (Rounded) ($)': document.getElementById('taxCollected').value,
        'Total Closing Cash ($)': document.getElementById('closingCash').value,
        'Total Closing Coin Adjustments ($)': document.getElementById('totalCoinAdjust').value,
        'Actual Deposit ($)': document.getElementById('actualDeposit').value,
        'Net Deposit ($)': document.getElementById('netDeposit').value,
        'Difference ($)': document.getElementById('difference').value
      }];
      const ws = XLSX.utils.json_to_sheet(data);
      XLSX.utils.book_append_sheet(wb, ws, 'Daily Deposit');
      const store = new URLSearchParams(location.search).get('store')||'Store';
      const date = new Date().toISOString().slice(0,10);
      XLSX.writeFile(wb, `${store}_DailyDeposit_${date}.xlsx`);
    });
  </script>

  <!-- XLSX library -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</body>
</html>
